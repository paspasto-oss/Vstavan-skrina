// --- VÝROBNÉ VZORCE A LOGIKA VÝPOČTU ---

function calculateAutomatedParts() {
    const W = parseFloat(document.getElementById('W').value); // Celková šírka otvoru
    const H = parseFloat(document.getElementById('H').value); // Celková výška otvoru
    const D = parseFloat(document.getElementById('D').value); // Celková hĺbka skrine
    const t = 18; // Štandardná hrúbka DTD (mm)
    const setback = 100; // Odsadenie vnútra pre koľajnice dverí
    const doorCount = parseInt(document.getElementById('doorCount').value);
    const overlap = 30; // Prekrytie dverí (mm)

    const parts = [];

    // 1. KORPUS (Variant bez dna - koľajnica na podlahe)
    // Boky skrine (stoja na zemi, siahajú po vrch)
    addPart(parts, "Bok skrine vonkajší", H, D, 2, "DTD 18mm");
    
    // Pôda (horný strop - vkladaný medzi boky)
    const pdaW = W - (2 * t);
    addPart(parts, "Pôda (strop korpusu)", pdaW, D, 1, "DTD 18mm");

    // Vnútorné stojky (idú od zeme po pôdu)
    const stojkaH = H - t;
    const stojkaD = D - setback;
    const pocetStojok = sections.length - 1;
    if (pocetStojok > 0) {
        addPart(parts, "Stojka vnútorná", stojkaH, stojkaD, pocetStojok, "DTD 18mm");
    }

    // 2. POLICE (Rozmer podľa šírky každej sekcie)
    sections.forEach((secW, index) => {
        // Polica je o 2mm užšia ako svetlosť sekcie pre ľahkú montáž
        addPart(parts, `Polica (Sekcia ${index + 1})`, Math.round(secW - 2), stojkaD, 4, "DTD 18mm");
    });

    // 3. POSUVNÉ DVERE (Hliníkový rámový systém)
    // Výpočet šírky krídla: (Svetlá šírka + (počet prekrytí * rozmer prekrytia)) / počet dverí
    const vnutornaSirka = W - (2 * t);
    const wingW = (vnutornaSirka + ((doorCount - 1) * overlap)) / doorCount;
    
    // Výška krídla: Celková výška - pôda(18) - vôľa pre kolajnice(40)
    const wingH = H - t - 40;

    // Výplň dverí (DTD 10mm alebo sklo)
    // Odpočty pre hliníkové profily (univerzálne: madlo 26mm, rám 38mm)
    const fillW = wingW - (2 * 26) + 14; // +14mm zapadnutie do madiel
    const fillH = wingH - 38; // Odpočet pre horný/dolný profil

    addPart(parts, "Dvere - výplň DTD 10mm", fillH, fillW, doorCount, "Výplň do rámu");
    addPart(parts, "Al Madlo zvislé", wingH, 0, doorCount * 2, "Hliníkový profil");
    addPart(parts, "Al Profil vodorovný", wingW - (2 * 26), 0, doorCount * 2, "Horný/Dolný rám");

    renderTable(parts);
    updatePrice(parts);
}

function addPart(list, name, dimA, dimB, qty, mat) {
    list.push({
        name: name,
        dim: `${Math.round(dimA)} x ${Math.round(dimB)}`,
        area: (dimA * dimB * qty) / 1000000,
        qty: qty,
        mat: mat
    });
}

function renderTable(parts) {
    const tbody = document.querySelector('#partsTable tbody');
    tbody.innerHTML = '';
    parts.forEach(p => {
        tbody.innerHTML += `
            <tr>
                <td style="padding:10px; border-bottom:1px solid #eee">${p.name}</td>
                <td style="padding:10px; border-bottom:1px solid #eee"><strong>${p.dim}</strong></td>
                <td style="padding:10px; border-bottom:1px solid #eee">${p.qty} ks</td>
                <td style="padding:10px; border-bottom:1px solid #eee">${p.mat}</td>
            </tr>`;
    });
}
